(()=>{"use strict";var t="cf336180-acdd-4618-920e-c3a47bf944b6",e="https://mesto.nomoreparties.co/v1/wbf-cohort-3/";function n(n){return fetch("".concat(e,"cards/likes/").concat(n),{method:"PUT",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}function o(n){return fetch("".concat(e,"cards/likes/").concat(n),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))}var r=document.querySelector(".profile__avatar"),c=document.querySelector(".profile__name"),u=document.querySelector(".profile__description"),i=document.querySelector(".profile__id"),a=document.querySelector("#popup-profile"),l=document.querySelector(".profile__edit-button"),s=document.querySelector("#popup-form-name"),p=document.querySelector("#popup-form-info"),d=document.querySelector("#popup-profile-avatar"),f=document.querySelector(".profile__avatar-edit-button"),m=document.querySelector("#popup-profile-url"),_=document.querySelector("#popup-places"),v=document.querySelector(".profile__add-button"),y=document.querySelector("#popup-form-place"),h=document.querySelector("#popup-form-link"),S=document.querySelector("#popup__full-image"),b=document.querySelector(".popup__image"),q=document.querySelector(".popup__image-description"),L=Array.from(document.querySelectorAll(".popup__form")),k=Array.from(document.querySelectorAll(".popup__close-button")),j=document.querySelector(".places"),C=document.querySelector("#place").content;function E(t,e,n,o,r){t(e._id).then((function(t){n.textContent=t.likes.length,r?o.classList.add("places__button-active"):o.classList.remove("places__button-active")})).catch((function(t){return console.log(t)}))}function g(r,c){var u=C.querySelector(".places__frame").cloneNode(!0),i=u.querySelector(".places__element"),a=u.querySelector(".places__description"),l=u.querySelector(".places__like-button"),s=u.querySelector(".places__id");return i.src=r.link,i.alt=r.name,a.textContent=r.name,l.textContent=r.likes.length,s.textContent=r._id,function(t,e,r){var c=t.querySelector(".places__button"),u=t.querySelector(".places__like-button");e.likes.map((function(t){return t._id})).includes(r)&&c.classList.add("places__button-active"),c.addEventListener("click",(function(){c.classList.contains("places__button-active")?E(o,e,u,c,!1):E(n,e,u,c,!0)}))}(u,r,c),function(n,o,r){var c=n.querySelector(".places__delete-button");o.owner._id!==r?c.classList.add("places__delete-button-inactive"):c.addEventListener("click",(function(){var r;(r=o._id,fetch("".concat(e,"cards/").concat(r),{method:"DELETE",headers:{authorization:t,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(){n.closest(".places__frame").remove()})).catch((function(t){return console.log(t)}))}))}(u,r,c),function(t,e){t.addEventListener("click",(function(){T(S),b.src=t.src,b.alt=e.textContent,q.textContent=e.textContent}))}(i,a),u}function x(t,e){!0===e?j.prepend(t):j.append(t)}function A(t){"Escape"===t.key&&P()}function T(t){t.classList.add("popup_opened"),document.addEventListener("keydown",A)}function P(){var t=document.querySelector(".popup_opened"),e=t.querySelector(".popup__form");t.classList.remove("popup_opened"),setTimeout((function(){return e.reset()}),500),document.removeEventListener("keydown",A)}function w(t,e){t.querySelector(".popup__button").textContent=e}function z(n){"popup-profile"===n.id?function(n){var o,r;w(n,"Сохранение..."),(o=s.value,r=p.value,fetch("".concat(e,"users/me"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,about:r})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(){c.textContent=s.value,u.textContent=p.value})).catch((function(t){return console.log(t)})).finally((function(){return w(n,"Сохранить")})),P()}(n):"popup-profile-avatar"===n.id?function(n){var o;w(n,"Сохранение..."),(o=m.value,fetch("".concat(e,"users/me/avatar"),{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(){return r.src=m.value})).catch((function(t){return console.log(t)})).finally((function(){return w(n,"Сохранить")})),P()}(n):"popup-places"===n.id&&function(n){var o,r;w(n,"Создание..."),(o=y.value,r=h.value,fetch("".concat(e,"cards"),{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:r})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){x(g(t,t.owner._id),!0)})).catch((function(t){return console.log("Ошибка создания карточки "+t)})).finally((function(){return w(n,"Создать")})),P()}(n)}function O(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove("popup__button-inactive"),e.disabled=!1):(e.classList.add("popup__button-inactive"),e.disabled=!0)}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}Promise.all([fetch("".concat(e,"users/me"),{headers:{authorization:t}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})),fetch("".concat(e,"cards"),{headers:{authorization:t}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))]).then((function(t){var e,n,o,a=(o=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,u,i=[],a=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);a=!0);}catch(t){l=!0,r=t}finally{try{if(!a&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return i}}(n,o)||function(t,e){if(t){if("string"==typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?N(t,e):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=a[0],s=a[1];e=l,c.textContent=e.name,u.textContent=e.about,r.src=e.avatar,r.alt=e.about,i.textContent=e._id,function(t,e){t.forEach((function(t){x(g(t,e),!1)}))}(s,i.textContent)})).catch((function(t){return console.log(t)})),function(t){t.forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=Array.from(t.querySelectorAll(".popup__form-text")),n=t.querySelector(".popup__button");O(e,n),e.forEach((function(o){o.addEventListener("input",(function(){!function(t,e){e.validity.valid?function(t,e){var n=t.querySelector(".".concat(e.id,"-error"));n.classList.remove("popup__input-error-active"),n.textContent="",e.classList.remove("popup__form-text-error")}(t,e):function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));o.classList.add("popup__input-error-active"),o.textContent=n,e.classList.add("popup__form-text-error")}(t,e,e.validationMessage)}(t,o),O(e,n)}))}))}(t)}))}(L),f.addEventListener("click",(function(){T(d)})),d.addEventListener("submit",(function(){z(d)})),l.addEventListener("click",(function(){T(a),s.value=c.textContent,p.value=u.textContent})),k.forEach((function(t){t.addEventListener("click",(function(){P()}))})),a.addEventListener("submit",(function(){z(a)})),v.addEventListener("click",(function(){T(_)})),_.addEventListener("submit",(function(){z(_)})),document.addEventListener("click",(function(t){var e=document.querySelector(".popup_opened");t.target===e&&P()}))})();